<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>곡괭이 채굴량 계산</title>
<style>
  body { background:#1a1a1a; color:#e0e0e0; font-family:'Noto Sans KR'; padding:20px; }
  h1 { color:#ffcc00; font-size:1.8em; }
  .settings-container { display:flex; gap:20px; flex-wrap:wrap; }
  .card { background:#292929; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.5); flex:1; min-width:300px;}
  .card h2 { margin:0 0 10px; color:#ffcc00; }
  .input-row { display:flex; gap:10px; margin-bottom:10px; }
  .input-row label { flex:1; display:flex; flex-direction:column; font-size:0.95em; }
  .input-row input, .input-row select {
    flex:1 1 auto; min-width:50px; max-width:120px; padding:6px; border:none; border-radius:4px;
    font-size:1em; background:#444; color:#fff;
  }
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button { transform:scale(1.5); }
  input[type=number] { -moz-appearance:textfield; }
  .input-row input[readonly] { background:#555; }
  button#calcBtn { background:#ffcc00; color:#222; border:none; padding:10px; border-radius:4px;
                   font-weight:bold; cursor:pointer; width:100%; margin-top:10px; }
  .result { background:#333; padding:10px; border-radius:4px; margin-top:10px; font-size:0.95em; }
  .highlight { color:#00ffcc; font-weight:bold; }
  .better { box-shadow:0 0 20px 5px rgba(255,255,0,0.6); }
</style>
</head>
<body>

<h1>곡괭이 채굴량 계산</h1>
<div>
  <label>광물 선택<select id="mineralSel">
    <option value="electric">전기석</option>
    <option value="salad">샬라드리움</option>
    <option value="ayan">아야안석</option>
  </select></label>
</div>

<div class="settings-container">
  <div class="card" id="setting1">
    <h2>세팅 1</h2>
    <div class="input-row">
      <label>강화 단계<select id="s1_level"></select></label>
      <label>기본공격력<readonly><input type="text" id="s1_baseAtk" readonly></label>
      <label>강화공격력<readonly><input type="text" id="s1_enhanceAtk" readonly></label>
    </div>
    <div class="input-row">
      <label>치명타(%)<input type="number" id="s1_critDmg"></label>
      <label>내 회피(%)<input type="number" id="s1_evasion" step="0.1"></label>
      <label>재생력(초당)<input type="number" id="s1_regen" step="1"></label>
    </div>
    <div class="input-row">
      <label>적중률<br>(+%)<input type="number" id="s1_hitRate" step="1"></label>
      <label>채굴량<input type="number" id="s1_miningBase" step="1"></label>
      <label>드론공격력(%)<input type="number" id="s1_dronePercent" step="4" min="0" max="100"></label>
    </div>
    <div class="result" id="s1_result"></div>
  </div>

  <div class="card" id="setting2">
    <h2>세팅 2</h2>
    <div class="input-row">
      <label>강화 단계<select id="s2_level"></select></label>
      <label>기본공격력<readonly><input type="text" id="s2_baseAtk" readonly></label>
      <label>강화공격력<readonly><input type="text" id="s2_enhanceAtk" readonly></label>
    </div>
    <div class="input-row">
      <label>치명타(%)<input type="number" id="s2_critDmg"></label>
      <label>내 회피(%)<input type="number" id="s2_evasion" step="0.1"></label>
      <label>재생력(초당)<input type="number" id="s2_regen" step="1"></label>
    </div>
    <div class="input-row">
      <label>적중률<br>(+%)<input type="number" id="s2_hitRate" step="1"></label>
      <label>채굴량<input type="number" id="s2_miningBase" step="1"></label>
      <label>드론공격력(%)<input type="number" id="s2_dronePercent" step="4" min="0" max="100"></label>
    </div>
    <div class="result" id="s2_result"></div>
  </div>
</div>

<button id="calcBtn">계산하기</button>
<div class="card">
  <h2>채굴량 차이</h2>
  <div class="result" id="diff_result"></div>
</div>

<script>
// 광물별 회피율 값
const mineralData = {
  electric: { hp:1600, shield:40, evade:10 },
  salad:    { hp:1600, shield:40, evade:20 },
  ayan:     { hp:4000, shield:100, evade:30 }
};

// 강화 곡괭이 공격력 표
const atkTable = {
  1:[1.01657,2.59226], /*…*/ 30:[2.39562,6.10883]
};

// UI 및 저장 관련
function setupLevels(){
  ['s1','s2'].forEach(id=>{
    const sel = document.getElementById(id+'_level');
    for(let i=1;i<=30;i++) sel.add(new Option(i+'강',i));
    sel.onchange = () => {
      const [b,e] = atkTable[sel.value];
      document.getElementById(id+'_baseAtk').value = b.toFixed(4);
      document.getElementById(id+'_enhanceAtk').value = e.toFixed(4);
      localStorage.setItem(id+'_level', sel.value);
      saveValues(id); doCalc();
    };
  });
}
function saveValues(id){
  ['critDmg','evasion','regen','hitRate','miningBase','dronePercent']
    .forEach(k=> localStorage.setItem(`${id}_${k}`, document.getElementById(`${id}_${k}`).value));
}
function loadValues(id){
  ['critDmg','evasion','regen','hitRate','miningBase','dronePercent']
  .forEach(k=>{
    const el = document.getElementById(`${id}_${k}`);
    el.value = localStorage.getItem(`${id}_${k}`) || el.value;
    el.oninput = () => { saveValues(id); doCalc(); };
  });
}

// 계산 로직
function calcOne(id){
  const minKey = document.getElementById('mineralSel').value;
  const {hp: mHP, shield: mSh, evade: mEv} = mineralData[minKey];
  const base = +document.getElementById(id+'_baseAtk').value;
  const en = +document.getElementById(id+'_enhanceAtk').value;
  const crit = +document.getElementById(id+'_critDmg').value/100;
  const dodge = +document.getElementById(id+'_evasion').value/100;
  const regen = +document.getElementById(id+'_regen').value;
  const hitB = +document.getElementById(id+'_hitRate').value;
  const mine = +document.getElementById(id+'_miningBase').value;
  const droneP = +document.getElementById(id+'_dronePercent').value/100;

  const netHit = Math.max(0, ((100+hitB)-mEv)/100*(1-dodge));
  const hitsPerSec = 4 * netHit;
  const tot = base+en;
  let shieldBurn = Math.max(0, tot*crit - mSh);
  if(shieldBurn<=0) shieldBurn=1;
  const hitsToBreak = Math.ceil((mHP+regen*hitsPerSec)/(shieldBurn));

  const totalHits = hitsPerSec*3600;
  const pick = Math.round(mine * totalHits / hitsToBreak);
  const droneHits = hitsPerSec*droneP*3600;
  const dronePick = Math.round(mine * droneHits / hitsToBreak);

  return { pick, drone: dronePick, total: pick+dronePick };
}

function doCalc(){
  const r1 = calcOne('s1'), r2 = calcOne('s2');
  document.getElementById('s1_result').innerHTML = 
    `곡괭이: <span class="highlight">${r1.pick}</span>개<br>` +
    `드론: <span class="highlight">${r1.drone}</span>개<br>` +
    `합계: <span class="highlight">${r1.total}</span>개`;

  document.getElementById('s2_result').innerHTML = 
    `곡괭이: <span class="highlight">${r2.pick}</span>개<br>` +
    `드론: <span class="highlight">${r2.drone}</span>개<br>` +
    `합계: <span class="highlight">${r2.total}</span>개`;

  document.getElementById('diff_result').innerHTML =
    `곡괭이 차이: <span class="highlight">${r2.pick-r1.pick}</span>개<br>` +
    `드론 차이: <span class="highlight">${r2.drone-r1.drone}</span>개<br>` +
    `합계 차이: <span class="highlight">${r2.total-r1.total}</span>개`;

  document.getElementById('setting1').classList.toggle('better', r1.total>r2.total);
  document.getElementById('setting2').classList.toggle('better', r2.total>r1.total);
}

function saveAll(){
  saveValues('s1'); saveValues('s2');
  localStorage.setItem('mineralSel', document.getElementById('mineralSel').value);
}

function loadAll(){
  setupLevels();
  loadValues('s1'); loadValues('s2');
  const savedMin = localStorage.getItem('mineralSel');
  if(savedMin) document.getElementById('mineralSel').value = savedMin;
  document.getElementById('mineralSel').onchange = () => { saveAll(); doCalc(); };

  ['s1','s2'].forEach(s=>{
    const lvl = localStorage.getItem(s+'_level')||30;
    document.getElementById(s+'_level').value = lvl;
    document.getElementById(s+'_level').dispatchEvent(new Event('change'));
  });

  document.getElementById('calcBtn').onclick = () => { saveAll(); doCalc(); };
  doCalc();
}

window.onload = loadAll;
</script>

</body>
</html>
